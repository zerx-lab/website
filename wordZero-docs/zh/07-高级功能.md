# 高级功能

本文档涵盖 WordZero 的高级功能，包括页眉页脚、目录、脚注、图片和列表。

## 页眉和页脚

### 添加页眉

```go
import "github.com/zerx-lab/wordZero/pkg/document"

doc := document.New()

// 添加简单页眉
header := doc.AddHeader(document.HeaderTypeDefault)
header.AddParagraph("公司名称 - 机密")

// 添加带格式的页眉
headerPara := header.AddFormattedParagraph("文档标题", &document.TextFormat{
    Bold:     true,
    FontSize: 14,
})
headerPara.SetAlignment(document.AlignCenter)
```

### 页眉类型

```go
// 默认页眉（出现在所有页面）
doc.AddHeader(document.HeaderTypeDefault)

// 首页页眉（首页使用不同的页眉）
doc.AddHeader(document.HeaderTypeFirst)

// 奇数页页眉
doc.AddHeader(document.HeaderTypeOdd)

// 偶数页页眉
doc.AddHeader(document.HeaderTypeEven)
```

### 添加页脚

```go
// 添加简单页脚
footer := doc.AddFooter(document.FooterTypeDefault)
footer.AddParagraph("第 1 页，共 10 页")

// 添加带页码的页脚
footer := doc.AddFooterWithPageNumber(document.FooterTypeDefault)
```

### 带自定义页码的页脚

```go
footer := doc.AddFooter(document.FooterTypeDefault)

// 创建带页码字段的段落
para := footer.AddParagraph("")
para.AddPageNumberField()
para.AddFormattedText(" / ", nil)
para.AddTotalPagesField()
para.SetAlignment(document.AlignCenter)
```

### 首页使用不同的页眉/页脚

```go
// 启用首页不同
doc.SetDifferentFirstPageHeaderFooter(true)

// 添加首页页眉
firstHeader := doc.AddHeader(document.HeaderTypeFirst)
firstHeader.AddParagraph("封面页眉")

// 添加其他页面的默认页眉
defaultHeader := doc.AddHeader(document.HeaderTypeDefault)
defaultHeader.AddParagraph("正文页眉")
```

### 奇偶页页眉

```go
// 启用奇偶页不同
doc.SetDifferentOddEvenPages(true)

// 添加奇数页页眉
oddHeader := doc.AddHeader(document.HeaderTypeOdd)
oddHeader.AddParagraph("奇数页页眉")

// 添加偶数页页眉
evenHeader := doc.AddHeader(document.HeaderTypeEven)
evenHeader.AddParagraph("偶数页页眉")
```

## 目录

### 生成目录

```go
doc := document.New()

// 添加目录占位符
doc.GenerateTOC(&document.TOCConfig{
    Title:      "目录",
    MaxLevel:   3,  // 包含最多3级标题
    ShowPageNumbers: true,
    RightAlignPageNumbers: true,
    UseHyperlinks: true,
})

// 添加带标题的内容
doc.AddHeadingParagraph("第一章：简介", 1)
doc.AddParagraph("简介内容...")

doc.AddHeadingParagraph("1.1 背景", 2)
doc.AddParagraph("背景内容...")

doc.AddHeadingParagraph("第二章：方法", 1)
doc.AddParagraph("方法内容...")

doc.Save("document-with-toc.docx")
```

### 目录配置

```go
type TOCConfig struct {
    Title                 string // 目录标题文本
    MaxLevel              int    // 最大标题级别（1-9）
    ShowPageNumbers       bool   // 显示页码
    RightAlignPageNumbers bool   // 页码右对齐
    UseHyperlinks         bool   // 使条目可点击
    TabLeader             string // 引导字符（"dot"、"hyphen"、"underscore"、"none"）
    StylePrefix           string // 目录条目的自定义样式前缀
}
```

### 更新目录

添加带标题的内容后，在 Word 中打开文档时目录会自动更新。要以编程方式触发更新：

```go
doc.UpdateTOC()
```

## 脚注和尾注

### 添加脚注

```go
doc := document.New()

para := doc.AddParagraph("这是一个需要引用的陈述")
doc.AddFootnote(para, "来源：张三（2024）。书名。出版社。")

// 添加另一个脚注
para2 := doc.AddParagraph("另一个重要事实")
doc.AddFootnote(para2, "参见：李四（2023）。研究论文。")
```

### 添加尾注

```go
para := doc.AddParagraph("一个带尾注引用的陈述")
doc.AddEndnote(para, "此尾注出现在文档末尾。")
```

### 脚注配置

```go
doc.SetFootnoteConfig(&document.FootnoteConfig{
    NumberFormat:    "decimal",     // "decimal"、"lowerRoman"、"upperRoman"、"lowerLetter"、"upperLetter"
    StartNumber:     1,             // 起始编号
    RestartEachPage: false,         // 每页重新编号
    Position:        "pageBottom",  // "pageBottom" 或 "beneathText"
})
```

### 尾注配置

```go
doc.SetEndnoteConfig(&document.EndnoteConfig{
    NumberFormat: "lowerRoman",
    StartNumber:  1,
    Position:     "docEnd",  // "docEnd" 或 "sectEnd"
})
```

## 图片

### 从文件添加图片

```go
doc := document.New()

// 使用默认设置添加图片
err := doc.AddImageFromFile("photo.jpg", nil)
if err != nil {
    log.Fatal(err)
}

// 使用自定义大小添加图片
err = doc.AddImageFromFile("logo.png", &document.ImageConfig{
    Width:  200,  // 点（points）
    Height: 100,
})
```

### 图片配置

```go
type ImageConfig struct {
    Width       float64 // 宽度（点）
    Height      float64 // 高度（点）
    Alignment   string  // "left"、"center"、"right"
    AltText     string  // 用于辅助功能的替代文本
    Title       string  // 图片标题
}

config := &document.ImageConfig{
    Width:     300,
    Height:    200,
    Alignment: "center",
    AltText:   "公司标志",
    Title:     "标志图片",
}

doc.AddImageFromFile("logo.png", config)
```

### 从字节添加图片

```go
// 读取图片数据
imageData, _ := os.ReadFile("image.jpg")

// 添加到文档
err := doc.AddImage(imageData, "image/jpeg", &document.ImageConfig{
    Width:  400,
    Height: 300,
})
```

### 浮动图片

```go
// 添加浮动（定位）图片
config := &document.FloatingImageConfig{
    Width:           200,
    Height:          150,
    HorizontalPos:   "right",      // "left"、"center"、"right"
    VerticalPos:     "top",        // "top"、"center"、"bottom"
    WrapType:        "square",     // "inline"、"square"、"tight"、"behind"、"inFront"
    HorizontalOffset: 0,           // 距锚点的点数
    VerticalOffset:   0,
    AllowOverlap:    false,
}

doc.AddFloatingImage("image.jpg", config)
```

### 图片格式

支持的图片格式：
- JPEG（.jpg、.jpeg）
- PNG（.png）
- GIF（.gif）
- BMP（.bmp）
- TIFF（.tif、.tiff）

## 列表和编号

### 项目符号列表

```go
doc := document.New()

// 添加项目符号列表
items := []string{
    "第一项",
    "第二项",
    "第三项",
}
doc.AddBulletList(items)
```

### 编号列表

```go
// 添加编号列表
items := []string{
    "步骤一",
    "步骤二",
    "步骤三",
}
doc.AddNumberedList(items)
```

### 多级列表

```go
// 创建多级列表
list := doc.CreateMultiLevelList()

// 0 级（顶级）
list.AddItem("第一章", 0)
    list.AddItem("第一节", 1)
        list.AddItem("主题 1.1.1", 2)
        list.AddItem("主题 1.1.2", 2)
    list.AddItem("第二节", 1)
list.AddItem("第二章", 0)
    list.AddItem("第一节", 1)
```

### 自定义编号

```go
// 创建自定义编号列表
list := doc.CreateNumberedList(&document.NumberingConfig{
    Format:     "decimal",     // "decimal"、"lowerLetter"、"upperLetter"、"lowerRoman"、"upperRoman"
    Start:      1,             // 起始编号
    Suffix:     ".",           // 编号后的文本
    Indent:     720,           // 缩进（twips）
})

list.AddItem("第一项")
list.AddItem("第二项")
list.AddItem("第三项")
```

### 嵌套列表示例

```go
doc := document.New()

// 创建主列表
doc.AddParagraph("项目需求：")

mainList := doc.CreateMultiLevelList()
mainList.SetBulletStyle(0, "bullet")
mainList.SetBulletStyle(1, "circle")
mainList.SetBulletStyle(2, "square")

mainList.AddItem("后端开发", 0)
    mainList.AddItem("API 设计", 1)
        mainList.AddItem("REST 端点", 2)
        mainList.AddItem("身份验证", 2)
    mainList.AddItem("数据库", 1)
        mainList.AddItem("模式设计", 2)
        mainList.AddItem("迁移", 2)
mainList.AddItem("前端开发", 0)
    mainList.AddItem("UI 组件", 1)
    mainList.AddItem("状态管理", 1)
```

## 文档属性

### 设置属性

```go
doc := document.New()

doc.SetProperties(&document.Properties{
    Title:          "2024年度报告",
    Subject:        "公司业绩",
    Creator:        "张三",
    Keywords:       "年度, 报告, 2024, 业绩",
    Description:    "2024财年年度业绩报告",
    LastModifiedBy: "李四",
    Category:       "商业",
    Version:        "1.0",
})

doc.Save("report.docx")
```

### 读取属性

```go
doc, _ := document.Open("report.docx")

props := doc.GetProperties()
fmt.Printf("标题: %s\n", props.Title)
fmt.Printf("创建者: %s\n", props.Creator)
fmt.Printf("创建时间: %s\n", props.Created)
fmt.Printf("修改时间: %s\n", props.Modified)
```

## 书签和超链接

### 添加书签

```go
// 创建书签
para := doc.AddParagraph("重要章节")
doc.AddBookmark(para, "important-section")

// 稍后引用书签
doc.AddParagraph("请参阅上面的 ")
doc.AddInternalHyperlink("important-section", "重要章节")
doc.AddParagraph("。")
```

### 添加超链接

```go
// 添加外部超链接
para := doc.AddParagraph("访问我们的网站：")
para.AddHyperlink("https://example.com", "Example.com")

// 添加邮件链接
para2 := doc.AddParagraph("联系我们：")
para2.AddHyperlink("mailto:info@example.com", "info@example.com")
```

## 分节符

### 添加分节符

```go
doc := document.New()

// 添加第一节内容
doc.AddParagraph("第一节内容")

// 添加分节符
doc.AddSectionBreak(document.SectionBreakNextPage)

// 添加具有不同设置的第二节内容
doc.SetPageOrientation(document.OrientationLandscape)
doc.AddParagraph("横向的第二节")

// 添加连续分节符
doc.AddSectionBreak(document.SectionBreakContinuous)
doc.AddParagraph("恢复正常流程")
```

### 分节符类型

```go
const (
    SectionBreakNextPage    = "nextPage"    // 从新页开始
    SectionBreakContinuous  = "continuous"  // 在同一页继续
    SectionBreakEvenPage    = "evenPage"    // 从下一偶数页开始
    SectionBreakOddPage     = "oddPage"     // 从下一奇数页开始
)
```

## 字段

### 常用字段

```go
para := doc.AddParagraph("")

// 添加日期字段
para.AddDateField("yyyy年M月d日")  // "2024年1月15日"

// 添加时间字段
para.AddTimeField("H:mm")    // "15:30"

// 添加页码字段
para.AddPageNumberField()

// 添加总页数字段
para.AddTotalPagesField()

// 添加文件名字段
para.AddFileNameField()
```

## 完整示例

```go
package main

import (
    "log"
    "github.com/zerx-lab/wordZero/pkg/document"
)

func main() {
    doc := document.New()

    // 设置文档属性
    doc.SetProperties(&document.Properties{
        Title:   "完整文档示例",
        Creator: "WordZero",
    })

    // 设置页面设置
    doc.SetPageSize(document.PageSizeA4)
    doc.SetPageMargins(1440, 1440, 1440, 1440)

    // 添加页眉
    header := doc.AddHeader(document.HeaderTypeDefault)
    header.AddFormattedParagraph("完整示例", &document.TextFormat{Bold: true})

    // 添加带页码的页脚
    footer := doc.AddFooter(document.FooterTypeDefault)
    footerPara := footer.AddParagraph("第 ")
    footerPara.AddPageNumberField()
    footerPara.AddFormattedText(" 页", nil)
    footerPara.SetAlignment(document.AlignCenter)

    // 添加标题
    title := doc.AddParagraph("完整文档示例")
    title.SetStyle("Title")

    // 添加目录
    doc.GenerateTOC(&document.TOCConfig{
        Title:    "目录",
        MaxLevel: 2,
    })

    doc.AddPageBreak()

    // 第一章
    doc.AddHeadingParagraph("第一章：简介", 1)
    doc.AddParagraph("本章介绍主要概念。")

    para := doc.AddParagraph("一个重要的事实")
    doc.AddFootnote(para, "此事实的引用来源。")

    // 添加图片
    doc.AddImageFromFile("diagram.png", &document.ImageConfig{
        Width:     400,
        Height:    200,
        Alignment: "center",
    })

    // 第二章带表格
    doc.AddHeadingParagraph("第二章：数据", 1)

    table := doc.AddTable(3, 3)
    table.Rows[0].Cells[0].AddParagraph("项目")
    table.Rows[0].Cells[1].AddParagraph("数量")
    table.Rows[0].Cells[2].AddParagraph("价格")
    // ... 添加更多数据

    // 第三章带列表
    doc.AddHeadingParagraph("第三章：总结", 1)
    doc.AddBulletList([]string{
        "关键发现 1",
        "关键发现 2",
        "关键发现 3",
    })

    // 保存
    if err := doc.Save("complete-example.docx"); err != nil {
        log.Fatal(err)
    }
}
```
