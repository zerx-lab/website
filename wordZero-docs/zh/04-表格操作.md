# 表格操作

WordZero 提供了全面的表格创建和操作功能。本文档涵盖从基本表格创建到高级格式化的所有内容。

## 创建表格

### 基本表格创建

```go
import "github.com/zerx-lab/wordZero/pkg/document"

doc := document.New()

// 创建一个 3 行 4 列的表格
table := doc.AddTable(3, 4)

// 访问单元格并添加内容
table.Rows[0].Cells[0].AddParagraph("表头 1")
table.Rows[0].Cells[1].AddParagraph("表头 2")
table.Rows[0].Cells[2].AddParagraph("表头 3")
table.Rows[0].Cells[3].AddParagraph("表头 4")

// 添加数据行
table.Rows[1].Cells[0].AddParagraph("第1行, 第1列")
table.Rows[1].Cells[1].AddParagraph("第1行, 第2列")
// ... 继续添加内容
```

### 使用 CreateTable

```go
// CreateTable 提供对表格结构更多的控制
table := doc.CreateTable(&document.TableConfig{
    Rows:    5,
    Columns: 3,
    Width:   9000, // 表格宽度（twips）
})
```

## 表格结构

### 理解表格层次结构

```
Table（表格）
├── TableProperties（表格属性：边框、宽度、对齐）
├── TableGrid（列定义）
└── Rows[]（行数组）
    └── TableRow（表格行）
        ├── RowProperties（行属性：高度、是否为标题行）
        └── Cells[]（单元格数组）
            └── TableCell（表格单元格）
                ├── CellProperties（单元格属性：宽度、边框、底纹）
                └── Paragraphs[]（段落数组）
```

### 访问表格元素

```go
// 访问特定行
row := table.Rows[0]

// 访问特定单元格
cell := table.Rows[0].Cells[1]

// 向单元格添加段落
para := cell.AddParagraph("单元格内容")

// 向单元格添加格式化段落
para := cell.AddFormattedParagraph("加粗文本", &document.TextFormat{Bold: true})
```

## 表格样式

### 表格边框

```go
// 设置表格边框
table.SetBorders(&document.TableBorderConfig{
    Top:     &document.Border{Style: "single", Size: 4, Color: "000000"},
    Bottom:  &document.Border{Style: "single", Size: 4, Color: "000000"},
    Left:    &document.Border{Style: "single", Size: 4, Color: "000000"},
    Right:   &document.Border{Style: "single", Size: 4, Color: "000000"},
    InsideH: &document.Border{Style: "single", Size: 4, Color: "CCCCCC"},
    InsideV: &document.Border{Style: "single", Size: 4, Color: "CCCCCC"},
})
```

### 边框样式

可用的边框样式：
- `single` - 单线
- `double` - 双线
- `dashed` - 虚线
- `dotted` - 点线
- `thick` - 粗线
- `nil` - 无边框

### 表格宽度

```go
// 设置表格宽度（twips）
table.SetWidth(9000) // 约 6.25 英寸

// 设置百分比宽度
table.SetWidthPercent(100) // 全页宽度
```

### 表格对齐

```go
// 设置表格在文档中的对齐方式
table.SetAlignment("center") // "left"（左）, "center"（中）, "right"（右）
```

## 单元格操作

### 单元格内容

```go
cell := table.Rows[0].Cells[0]

// 添加简单文本
cell.AddParagraph("简单文本")

// 添加多个段落
cell.AddParagraph("第一段")
cell.AddParagraph("第二段")

// 添加格式化文本
cell.AddFormattedParagraph("格式化文本", &document.TextFormat{
    Bold:      true,
    FontColor: "FF0000",
})
```

### 单元格宽度

```go
// 设置单个单元格宽度（twips）
cell.SetWidth(2000)

// 设置宽度类型
cell.SetWidthType("dxa")  // 固定宽度（twips）
cell.SetWidthType("pct")  // 百分比
cell.SetWidthType("auto") // 自动
```

### 单元格底纹（背景颜色）

```go
// 设置单元格背景颜色
cell.SetShading("E6F2FF") // 浅蓝色

// 设置带底纹的标题行
for _, cell := range table.Rows[0].Cells {
    cell.SetShading("4472C4") // 蓝色标题
    cell.AddFormattedParagraph("表头", &document.TextFormat{
        Bold:      true,
        FontColor: "FFFFFF", // 白色文字
    })
}
```

### 单元格垂直对齐

```go
// 在单元格内垂直对齐内容
cell.SetVerticalAlignment("top")    // 顶部
cell.SetVerticalAlignment("center") // 居中
cell.SetVerticalAlignment("bottom") // 底部
```

### 单元格边距（内边距）

```go
cell.SetMargins(&document.CellMargins{
    Top:    100, // twips
    Right:  100,
    Bottom: 100,
    Left:   100,
})
```

## 合并单元格

### 水平合并（跨列）

```go
// 水平合并单元格（跨 3 列）
table.Rows[0].Cells[0].SetHorizontalMerge("restart") // 合并起始
table.Rows[0].Cells[1].SetHorizontalMerge("continue")
table.Rows[0].Cells[2].SetHorizontalMerge("continue")

// 只在第一个单元格添加内容
table.Rows[0].Cells[0].AddParagraph("合并的表头")
```

### 垂直合并（跨行）

```go
// 垂直合并单元格（跨 3 行）
table.Rows[0].Cells[0].SetVerticalMerge("restart") // 合并起始
table.Rows[1].Cells[0].SetVerticalMerge("continue")
table.Rows[2].Cells[0].SetVerticalMerge("continue")

// 只在第一个单元格添加内容
table.Rows[0].Cells[0].AddParagraph("合并的单元格")
```

### 复杂合并示例

```go
// 创建带有合并单元格的表格
table := doc.AddTable(4, 4)

// 合并左上角 2x2 区域
table.Rows[0].Cells[0].SetHorizontalMerge("restart")
table.Rows[0].Cells[1].SetHorizontalMerge("continue")
table.Rows[0].Cells[0].SetVerticalMerge("restart")
table.Rows[1].Cells[0].SetVerticalMerge("continue")
table.Rows[1].Cells[0].SetHorizontalMerge("restart")
table.Rows[1].Cells[1].SetHorizontalMerge("continue")

table.Rows[0].Cells[0].AddParagraph("2x2 合并区域")
```

## 行操作

### 行高

```go
// 设置行高（twips）
table.Rows[0].SetHeight(500)

// 设置高度规则
table.Rows[0].SetHeightRule("exact")   // 固定高度
table.Rows[0].SetHeightRule("atLeast") // 最小高度
table.Rows[0].SetHeightRule("auto")    // 自动
```

### 标题行

```go
// 将行标记为标题（在每页重复显示）
table.Rows[0].SetHeader(true)
```

### 防止行跨页断开

```go
table.Rows[0].SetCantSplit(true)
```

## 嵌套表格

WordZero 支持在表格单元格内嵌套表格：

```go
// 创建外层表格
outerTable := doc.AddTable(2, 2)

// 在单元格中添加嵌套表格
outerTable.Rows[0].Cells[0].AddParagraph("包含嵌套表格的单元格：")
nestedTable := outerTable.Rows[0].Cells[0].AddTable(2, 2)

nestedTable.Rows[0].Cells[0].AddParagraph("嵌套 1")
nestedTable.Rows[0].Cells[1].AddParagraph("嵌套 2")
nestedTable.Rows[1].Cells[0].AddParagraph("嵌套 3")
nestedTable.Rows[1].Cells[1].AddParagraph("嵌套 4")
```

## 表格条纹（交替行颜色）

```go
// 应用交替行颜色
for i, row := range table.Rows {
    color := "FFFFFF" // 白色
    if i%2 == 1 {
        color = "F2F2F2" // 浅灰色
    }
    for _, cell := range row.Cells {
        cell.SetShading(color)
    }
}
```

## 完整表格示例

```go
func createStyledTable(doc *document.Document) {
    // 创建表格
    table := doc.AddTable(5, 4)

    // 设置标题行样式
    headers := []string{"产品", "数量", "单价", "总计"}
    for i, header := range headers {
        cell := table.Rows[0].Cells[i]
        cell.SetShading("4472C4")
        cell.AddFormattedParagraph(header, &document.TextFormat{
            Bold:      true,
            FontColor: "FFFFFF",
        })
    }
    table.Rows[0].SetHeader(true)

    // 添加带交替颜色的数据
    data := [][]string{
        {"产品 A", "10", "¥5.00", "¥50.00"},
        {"产品 B", "5", "¥10.00", "¥50.00"},
        {"产品 C", "20", "¥2.50", "¥50.00"},
        {"合计", "", "", "¥150.00"},
    }

    for i, rowData := range data {
        row := table.Rows[i+1]
        bgColor := "FFFFFF"
        if i%2 == 1 {
            bgColor = "F2F2F2"
        }

        for j, cellData := range rowData {
            cell := row.Cells[j]
            cell.SetShading(bgColor)
            cell.AddParagraph(cellData)
        }
    }

    // 合并"合计"行的前 3 个单元格
    table.Rows[4].Cells[0].SetHorizontalMerge("restart")
    table.Rows[4].Cells[1].SetHorizontalMerge("continue")
    table.Rows[4].Cells[2].SetHorizontalMerge("continue")

    // 设置表格边框
    table.SetBorders(&document.TableBorderConfig{
        Top:     &document.Border{Style: "single", Size: 4, Color: "4472C4"},
        Bottom:  &document.Border{Style: "single", Size: 4, Color: "4472C4"},
        Left:    &document.Border{Style: "single", Size: 4, Color: "4472C4"},
        Right:   &document.Border{Style: "single", Size: 4, Color: "4472C4"},
        InsideH: &document.Border{Style: "single", Size: 4, Color: "CCCCCC"},
        InsideV: &document.Border{Style: "single", Size: 4, Color: "CCCCCC"},
    })

    // 设置表格宽度为 100%
    table.SetWidthPercent(100)
}
```

## 从现有文档读取表格

```go
doc, _ := document.Open("existing.docx")

// 遍历文档元素
for _, element := range doc.Body.Elements {
    if table, ok := element.(*document.Table); ok {
        // 处理表格
        for rowIndex, row := range table.Rows {
            for cellIndex, cell := range row.Cells {
                // 获取单元格文本
                text := cell.GetText()
                fmt.Printf("第 %d 行, 第 %d 列: %s\n", rowIndex, cellIndex, text)
            }
        }
    }
}
```
